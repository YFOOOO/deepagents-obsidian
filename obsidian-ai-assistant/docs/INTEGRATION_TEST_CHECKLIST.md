# Obsidian 插件集成测试检查清单

**测试日期**: 2025-11-14  
**测试版本**: 0.1.0  
**测试人**: YF

---

## ✅ 准备工作（已完成）

- [x] 插件已构建 (main.js 存在)
- [x] 插件文件已复制到 vault
  - `/Users/yf/Documents/obsidian agent/.obsidian/plugins/obsidian-ai-assistant/`
- [x] API 服务器正在运行 (http://localhost:8000)
- [x] API 端点测试全部通过 (3/3)

---

## 📋 在 Obsidian 中的测试步骤

### 第一部分：插件加载 (10 分钟)

#### 1. 启用插件
- [ ] 打开 Obsidian
- [ ] 进入 Settings (设置)
- [ ] 点击 Community plugins (第三方插件)
- [ ] 关闭 "Restricted mode" (安全模式)
- [ ] 刷新已安装插件列表
- [ ] 找到 "AI Assistant (DeepAgents)"
- [ ] 点击启用开关

**预期结果**: 
- ✅ 插件出现在列表中
- ✅ 可以成功启用
- ✅ 无错误提示

**如果失败**:
- 检查开发者控制台 (Cmd/Ctrl + Shift + I) 查看错误信息
- 检查 main.js 文件是否存在且完整

---

#### 2. 检查插件图标
- [ ] 在左侧边栏查找机器人图标 🤖
- [ ] 图标应该可见且可点击

**预期结果**: 
- ✅ 左侧边栏显示机器人图标
- ✅ 鼠标悬停显示 "Open AI Assistant" 提示

**如果失败**:
- 检查 manifest.json 中的 ribbonIcon 配置
- 重新加载 Obsidian

---

#### 3. 打开设置面板
- [ ] Settings → AI Assistant (在 Plugin Options 下)
- [ ] 设置面板能够打开

**预期结果**: 
- ✅ 设置面板显示
- ✅ 包含以下设置项：
  - Backend API URL (默认: http://localhost:8000)
  - API Key (可选)
  - Model (默认: qwen-turbo)
  - Enable Caching
  - Enable Smart Routing

**如果失败**:
- 检查 settings.ts 实现
- 查看控制台错误

---

### 第二部分：基本功能 (15 分钟)

#### 4. 打开聊天界面
- [ ] 点击左侧边栏的机器人图标
- [ ] 或使用命令面板 (Cmd/Ctrl + P) → "Open AI Assistant"

**预期结果**: 
- ✅ 右侧打开聊天面板
- ✅ 显示 "AI Assistant" 标题
- ✅ 显示输入框和发送按钮
- ✅ 顶部显示连接状态指示器

**如果失败**:
- 检查 chat-view.ts 实现
- 查看控制台错误

---

#### 5. 检查连接状态
- [ ] 查看聊天界面顶部的状态指示器

**预期结果**: 
- ✅ 显示绿色圆点 🟢
- ✅ 文本显示 "Connected"

**如果显示 "Disconnected"**:
- 检查 API 服务器是否运行 (curl http://localhost:8000/health)
- 检查设置中的 API URL 是否正确
- 查看浏览器网络请求 (F12 → Network)

---

#### 6. 发送第一个查询
- [ ] 在输入框输入: "你好，测试一下"
- [ ] 点击发送按钮或按 Enter

**预期结果**: 
- ✅ 输入框清空
- ✅ 查询显示在聊天历史中
- ✅ 显示加载指示器
- ✅ 5-15 秒内收到回复
- ✅ 回复显示在聊天历史中

**如果失败**:
- F12 查看网络请求
- 检查 API 服务器日志
- 验证 /query 端点是否正常

---

#### 7. 测试本地笔记搜索
- [ ] 输入查询: "我的 vault 里有关于 Obsidian 的笔记吗？"
- [ ] 发送查询

**预期结果**: 
- ✅ 收到回复
- ✅ 回复中包含本地笔记引用 (如果有相关笔记)
- ✅ 引用格式为 `[[path|name]]`
- ✅ 点击链接可以跳转到对应笔记

**如果失败**:
- 检查 Obsidian 路径配置
- 检查 vault 中是否有相关笔记

---

#### 8. 测试网页搜索
- [ ] 输入查询: "2025年最新的 Obsidian 插件有哪些？"
- [ ] 发送查询

**预期结果**: 
- ✅ 收到回复
- ✅ 回复中包含网页链接
- ✅ 链接格式为 `[标题](URL)`
- ✅ 显示来源信息

**如果失败**:
- 检查 TAVILY_API_KEY 是否设置
- 查看 API 服务器日志

---

### 第三部分：高级功能 (10 分钟)

#### 9. 检查源引用显示
- [ ] 发送任意查询
- [ ] 查看回复下方的 "Sources" 部分

**预期结果**: 
- ✅ 显示 "Sources:" 标题
- ✅ 列出所有引用来源
- ✅ 本地笔记: `[[path|name]]` 格式
- ✅ 网页: `[标题](URL)` 格式

---

#### 10. 测试 Token 统计
- [ ] 发送查询后查看回复底部

**预期结果**: 
- ✅ 显示 Token 使用信息
- ✅ 格式: "Tokens: XX input + XX output = XX total (¥X.XXXX)"
- ✅ 数字合理（通常几百到几千）

---

#### 11. 测试缓存功能
- [ ] 发送相同的查询两次
- [ ] 第二次应该明显更快

**预期结果**: 
- ✅ 第二次响应时间 < 1秒
- ✅ 显示 "⚡ Cached" 标记
- ✅ Token 统计显示为缓存结果

---

#### 12. 修改设置
- [ ] 打开设置面板
- [ ] 修改 Model 为 "qwen-plus"
- [ ] 保存设置
- [ ] 发送新查询

**预期结果**: 
- ✅ 设置保存成功
- ✅ 新查询使用新模型
- ✅ 插件无需重启

---

### 第四部分：错误处理 (5 分钟)

#### 13. 测试后端断线
- [ ] 停止 API 服务器 (在服务器终端按 Ctrl+C)
- [ ] 在聊天界面发送查询

**预期结果**: 
- ✅ 状态指示器变为红色 🔴 "Disconnected"
- ✅ 显示友好的错误消息
- ✅ 提示检查后端服务器

---

#### 14. 测试后端恢复
- [ ] 重新启动 API 服务器
- [ ] 等待 5-10 秒
- [ ] 发送新查询

**预期结果**: 
- ✅ 状态指示器变回绿色 🟢
- ✅ 查询正常处理
- ✅ 无需重启插件

---

#### 15. 测试空查询
- [ ] 尝试发送空消息

**预期结果**: 
- ✅ 发送按钮禁用或无反应
- ✅ 不会发送空请求到后端

---

## 📊 测试结果总结

### 测试统计
- [ ] 插件加载: __ / 3 通过
- [ ] 基本功能: __ / 5 通过
- [ ] 高级功能: __ / 4 通过
- [ ] 错误处理: __ / 3 通过
- **总计**: __ / 15 通过

### 性能数据
- 首次查询响应时间: _______ 秒
- 缓存查询响应时间: _______ 秒
- 平均 Token 使用: _______
- 平均成本: ¥_______

### 发现的问题
1. 
2. 
3. 

### 整体评价
- [ ] 优秀 (13-15 通过)
- [ ] 良好 (10-12 通过)
- [ ] 及格 (7-9 通过)
- [ ] 需改进 (<7 通过)

---

## 📝 测试笔记

### 成功的功能


### 需要改进的地方


### 意外发现


---

**测试完成时间**: __________  
**测试人签名**: __________  
**下一步行动**: __________
